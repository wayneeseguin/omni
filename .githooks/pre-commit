#!/bin/bash
# Pre-commit hook - Runs on git commit
# Ensures code quality before allowing commits

set -e

echo "üîç Running pre-commit checks..."

# Run go fmt to check formatting
echo "‚Üí Checking code formatting (go fmt)..."
unformatted=$(gofmt -l .)
if [ -n "$unformatted" ]; then
    echo "‚ùå The following files are not properly formatted:"
    echo "$unformatted"
    echo ""
    echo "Please run 'go fmt ./...' to format your code."
    exit 1
fi
echo "‚úÖ Code formatting check passed"

# Run go vet for static analysis
echo "‚Üí Running static analysis (go vet)..."
if ! go vet ./...; then
    echo "‚ùå Static analysis failed. Please fix the issues reported by 'go vet'."
    exit 1
fi
echo "‚úÖ Static analysis passed"

# Verify the project builds
echo "‚Üí Verifying build (make build)..."
if ! make build > /dev/null 2>&1; then
    echo "‚ùå Build failed. Please ensure your code compiles before committing."
    echo "Run 'make build' to see the full error output."
    exit 1
fi
echo "‚úÖ Build verification passed"

echo "‚ú® All pre-commit checks passed! Proceeding with commit..."